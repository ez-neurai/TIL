# 뇌파 전처리 中 편
## 뇌파 분석 절차
## > 전반적 과정
1. 뇌파 연구 설계 및 디지털 뇌파 자료 기록
2. 적절한 필터를 가한 후 연구 목적에 맞게 일정한 길이의 절편으로 절단
3. 절단된 절편을 다시 붙인 후 분절마다의 기저선을 보정
4. 잡파는 일차적으로 육안을 통해 제거 후 독립성분 분석을 이용해 안전도나 근전도 등의 특징적인 잡파 성분을 제거
5. 전반적으로 자료의 질이 좋지만 소수의 특정 채널이 나쁠 경우, 특정 채널을 제거한 후에 내삽 (interpolation) 을 이용하여 가상의 채널로 대체
6. 잡파를 제거하였어도 자료의 질이 좋지 않은 분절은 분석에서 제외
7. 최종적으로 얻은 깨끗한 자료에 참조 전극을 재설정하는 재기준화 과정을 거침

<br>

< 안정뇌파의 일반적인 분석 절차 >

<br>
<a href="https://ibb.co/PZrZrMw"><img src="https://i.ibb.co/vxcxchZ/image.png" alt="image" border="0"></a>

<br>
< 사건 관련 전위의 일반적인 분석 절차 >

<br>
<a href="https://ibb.co/5Wwq2S5"><img src="https://i.ibb.co/BVF8wQg/image.png" alt="image" border="0"></a>


<br>

## > 신호와 잡음 사이의 균형
뇌파 자료는 신호와 잡음이 아주 밀접한 형태로 함께 포함되어 있다. 적절한 전처리 (Preprocessing) 은 자료에서 잡음을 어느 정도 감소시켜주겠지만, 완전하게 분리하기는 어렵다.  

따라서 잡음으로 추정되는 부분을 많이 제거하면 일부 정상 신호가 함께 제거되거나 신호로 생각하고 남긴 부분이 많을수록 잡음이 포함되어 있을 가능성이 커진다.

또한 연구자의 의도나 연구의 목적에 따라 정상적인 뇌파 자료도 잡음으로 간주될 수 있다. A 연구자는 사건 유발 전위 (ERP) 를 중점적으로 볼 수 있고, B 연구자는 사건 유발 전위를 배제할 수도 있다는 것이다.

신호와 잡파를 나누는 기준은 다음과 같다.  

+ 시간 필터 적용 (temporal filtering) ; high-pass filter, low-pass filter
+ 독립성분 분석기법 기반 배제 (independent components analysis-based rejection)
+ 안구운동 기반 시도 배제 (oculomoter-based trial rejection)

등이 있는데, 이러한 기준은 전처리의 각 단계에 영향을 미칠 것이다. 또한 이 기준들의 결정은 얼마나 많은 자료를 가졌는지, 자료 획득에 있어 얼마나 어려운지에 따라서도 영향을 받는다.  
예를 들어 뇌전증 환자에게서 두개강내전극으로 기록한 뇌파 자료와 같이 쉽게 확보하기 어려운 경우, 약간의 잡음은 기꺼이 허용해야 가능한 한 많은 자료를 분석에 사용할 수 있을 것이다.

신호대잡음비 (signal to noise ratio, SNR) 는 신호와 잡음을 분리할 목적으로 사용할 수 있는 개념이다. 이는 주어진 시간에서 원하는 신호와 잡음 크기의 비율을 의미한다. 뇌파와 같은 시간-주파수 기반의 분석은 신호에 대한 잡음의 특성을 증가시키는 경향이 있다. 따라서 뇌파 자료는 신호와 잡음을 분리하기 어렵고, 신호대잡음비가 매우 낮다고 볼 수 있다.

<br>

<img src="https://www.frontiersin.org/files/Articles/600543/fnins-15-600543-HTML-r1/image_m/fnins-15-600543-g001.jpg" width="400" height="400"/>

Ref. www.frontiersin.org

## > 표본화 비율
뇌파 신호는 시간 흐름에 따른 전위의 지속적인 변화로 시간 함수이다. 아날로그 뇌파 시스템에서 얻어진 뇌파 신호는 디지털로 전환되는 과정에서 표본화 비율 (sampling rate) 이 적용된다. 

표본화 (sampling) 의 정의는 **파형의 즉각적인 값을 일정한 간격으로 얻는 과정** 이며, 나누어진 시간이라는 개별 요소에 대응하는 나누어진 전위의 값은 오직 하나라는 원칙에 따라서 이루어진다. (일대일대응)

표본화 비율의 수치는 1초 동안에 나타나는 나누어진 개별 점 자료의 숫자로 표현된다.

분석 전 중요한 것은 적절한 표본화 주파수를 결정하는 것이다. 여기서 **표본화 정리 (sampling theorem)** 라는 규칙이 적용된다.

아날로그 신호를 디지털 신호로 변환할 때 아날로그 신호 주파수의 최소 두 배 빈도로 표본화해야 적절한 디지털 파형으로 그릴 수 있다는 것이다.

이러한 최소한의 주파수를 **Nyquist frequency** 라고 한다. 표본화 비율이 변환하려는 신호 주파수의 두 배가 되지 않을 경우, 그려진 파형이 왜곡되어 나타날 수 있는데, 이러한 현상을 **위신호 현상 (aliasinig phenomenon)** 이라고 한다.

<br>

**|| 추가 설명 작성 예정 ||**

<br>

## > 필터 적용과 기저선 교정
뇌에서 발생하는 모든 전위를 기록하고 보여주고, 이를 분석에 이용하는 것은 불가능하다. 왜냐하면 불필요한 성분의 뇌파 신호는 필터 적용 (filtering) 을 통해 제거하기 때문이다.  

디지털 뇌파 자료 작업에서 필터를 다룰 때는 시간 영역에서 주파수 영역으로 바꾸어서 **필요한 주파수 부분만 추출하여 통과 처리하는 방식**을 이용한다. 이 방식의 목적은 다음과 같다.  

+ 입력 신호의 질 향상
+ 잡파 제거 및 감소
+ 합쳐진 신호를 다시 나누는 것

뇌파 신호의 경우 시간 영역의 신호를 주파수 영역으로 변환할 때 완벽하게 변환하고 복원하는 것은 불가능하여, 필터를 어떤 모양으로 만들어 사용하는 것이 신호를 완벽하게 변환하고 복원할 수 있는지 고민하는 게 중요하다.

필터는 유한 임펄스 응답 필터 (finite impulse response filter ; FIR filter) 와 무한 임펄스 응답 필터 (infinite impulse response filter ; IIR filter) 로 나눌 수 있다.  

특정 신호를 필터 적용 과정을 통해 처리하였을 때 나오는 반응을 임펄스 응답 (impulse response) 라고 한다. 응답으로부터 나오는 값들이 유한한지 무한한지에 따라 구분된다. FIR 은 신호 처리 후 값이 특정 포인트에서 끝나고, IIR 은 끝이 없다.

대부분 뇌파 자료의 시간-주파수 분해에서는 FIR 이 더 선호된다. 보다 더 안정적이고 비선형 위상 왜곡 (nonlinear phase distortions) 이 적기 때문이다. 

다른 주파수를 줄이면서 (attenuation) 하면서 일부 주파수를 강조하기 위해 사용하는 필터는 4 가지가 있다.  

- 고주파 통과 필터 (high-pass filter)  
설정된 기준보다 높은 주파수 신호만 통과시킨다.


- 저주파 통과 필터 (low-pass filter)  
설정된 기준보다 낮은 주파수 신호만 통과시킨다.

- 새김눈 필터 (notch filter)
교류 전원에서 전해지는 강한 60 Hz 잡파를 선택적으로 제거한다.

- 통과 구간 필터 (band pass filter)  
원하는 주파수만 통과시키고 나머지는 걸러준다. 여러 주파수를 세밀하게 나누어 분석할 경우 이 필터를 이용하는 것이 좋다. 따라서 **통과 구간 필터는 뇌파 자료의 시간주파수분해 시 가장 많이 사용된다.**

뇌파 신호는 시간에 따라 변하는 특성으로 인해 복잡한 패턴의 기저선 이동 현상 (shift) 이 발생한다. 이를 잡파로 가정하고 제거하는 것은 뇌파 분석 전 필요하다. 이를 **기저선 교정 (baseline correction)** 이라고 한다.  

대표적으로 ERP 의 경우, 작극을 하기 전에 기록된 전압의 평균을 구해 전체 분절의 전압값에서 빼면 다양한 이유로 발생한 기저선 이동 현상이 교정되어 분석 결과에 영향을 줄일 수 있게 된다.  
이와 같이 자극 전 전압의 평균값과 같은 상수를 이용한 기저선 교정을 **상수 경향 제거 (constant trend removal)** 이라고 한다.  
긴 시간동안 연속된 뇌파 자료를 분석할 경우 호흡이나 땀 분비로 인해 발생한 잡파 ; 느린 주파수 성분 가 포함될 경우 이를 제거하기 위해 고주파 통과 필터를 이용하기도 하지만 느린 파형을 선형 함수로 근사하여 선형 함수 값을 빼기도 하는데 이를 **선형 경향 제거 (linear trend removal)** 라고 한다.
